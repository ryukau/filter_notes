<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja" >

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
      <meta name="dcterms.date" content="2025-01-07" />
      <title>ptr_trapezoid</title>

  <style>
    :root {
      --background-color: #ffffff;
      --foreground-color: #000000;
      --table-odd-background-color: #eeeeee;
      --link-color: #0000ee;
      --visited-color: #551a8b;
      --active-color: #ff0000;
      --border-color: #888888;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --background-color: #202020;
        --foreground-color: #eeeeee;
        --table-odd-background-color: #333333;
        --link-color: #88aaee;
        --visited-color: #dd77cc;
        --active-color: #ff6666;
        --border-color: #888888;
      }

      audio,
      code,
      img,
      .MathJax_ref,
      .sourceCode {
        /*
        0.8745 ~= 1 - 0x20 / 0xff.
        0x20 and 0xff are brightness of dark and light theme.
        */
        filter: invert(0.8745098039215686);
      }

      pre>code {
        filter: invert(0);
      }
    }

    body {
      max-width: 704px;
      margin: auto;
      padding: 32px 8px;

      background-color: var(--background-color);
      color: var(--foreground-color);
    }

    img {
      max-width: 100%;
    }

    video {
      max-width: 100%;
    }

    kbd {
      font-family: inherit;
      border-style: solid;
      border-width: 1px 2px 2px 1px;
      border-radius: 2px;
      padding: 4px;
      margin: 2px;
      line-height: calc(1em + 16px);
    }

    a {
      text-decoration: none;
    }

    :link {
      color: var(--link-color);
    }

    :visited {
      color: var(--visited-color);
    }

    :link:active,
    :visited:active {
      color: var(--active-color);
    }

    .header-anchor {
      color: var(--foreground-color);
    }

    .header-anchor:hover {
      color: var(--link-color);
    }

    .header-anchor:hover::after {
      display: inline-block;
      font-size: min(1em, 1rem);
      content: '(クリックでここへリンク)';
      padding-left: 1em;
      color: var(--link-color);
    }

    h2 {
      border-left: solid 32px #000000;
      padding-left: 24px;
    }

    h3 {
      border-left: solid 20px #404040;
      padding-left: 16px;
    }

    h4 {
      font-size: 100%;
      border-left: solid 12px #606060;
      padding-left: 8px;
    }

    h5 {
      font-size: 90%;
      border-left: solid 8px #808080;
      padding-left: 8px;
    }

    h6 {
      font-size: 80%;
      border-left: solid 4px #a0a0a0;
      padding-left: 4px;
    }

    table {
      border-spacing: 0px;
      border-collapse: separate;
      border-left: 1px solid var(--border-color);
      border-right: 1px solid var(--border-color);
      border-top: 1px solid var(--border-color);
      border-bottom: hidden;
    }

    tr:nth-child(odd) {
      background: var(--table-odd-background-color);
    }

    tr:nth-child(even) {
      background: var(--background-color);
    }

    th {
      height: 2em;
      padding: 4px 1em 4px 1em;
      background: var(--background-color);
      border-bottom: 1px solid var(--border-color);
    }

    th:not(:first-child) {
      border-left: 1px solid var(--border-color);
    }

    td {
      height: 1.5em;
      padding: 4px 1em 4px 1em;
      border-bottom: 1px solid var(--border-color);
    }

    td:not(:first-child) {
      border-left: 1px solid var(--border-color);
    }

    dl {
      padding-left: 2em;
    }

    dt {
      font-weight: bold;
      border-bottom: 1px dashed #000000;
      margin-top: 2em;
    }

    dd {
      border-left: 1px dotted #000000;
      margin-left: 1em;
      padding-left: 1em;
    }

    audio {
      vertical-align: middle;
    }

    label {
      vertical-align: middle;
    }

    :not(.sourceCode)>pre {
      overflow: auto;
      border: 1px solid var(--border-color);
      padding: 8px;
    }

    div.sourceCode {
      overflow: auto;
      border: 1px solid var(--border-color);
      padding: 8px;
    }

    pre>code.sourceCode>span>a:first-child::before {
      border-right: 1px solid var(--border-color);
      padding-right: 1em;
      margin-right: 1em;
      text-decoration: none;
    }

    :not(pre)>code {
      color: #163eac;
    }

    li {
      margin: 8px;
    }

    summary:hover {
      background-color: var(--table-odd-background-color);
    }

    header {
      border-bottom: 1px var(--border-color) solid;
      padding: 0.5em;
      margin-bottom: 1em;
    }

    footer {
      border-top: 1px var(--border-color) solid;
      padding: 0.5em;
      margin-top: 1em;
    }


    canvas {
      /* image-rendering: pixelated; */
      display: inline-block;
      border-style: solid;
      border-width: 1px;
      border-color: #627f84;
    }

    .controlBlock {
      display: inline-block;
      width: 450px;
      text-align: left;
      vertical-align: top;
      margin-left: 4px;
    }

    input[type="button"] {
      background-color: #ffffff;
      border: 2px solid #aaaaaa;
      font-size: 16px;
      height: 32px;
    }

    input[type="button"]:hover {
      background-color: #ffffff;
      border: 2px solid #aaccff;
    }

    div.numberInput {
      display: block;
      white-space: nowrap;
    }

    div.numberInput:hover {
      background-color: #e0ecff;
    }

    .numberInputLabel {
      /* max 12 letter  */
      display: inline-block;
      margin: 0 8px 0 8px;
      text-align: left;
      vertical-align: middle;
      width: 100px;

      font-size: 10pt;
      font-family: 'Courier New', Courier, monospace;
    }

    .numberInputNumber {
      display: inline-block;
      vertical-align: middle;
      width: 120px;
    }

    .numberInputRange {
      display: inline-block;
      vertical-align: middle;
      width: 160px;
    }

    .pullDownMenu {
      display: inline-block;
      text-align: center;
    }

    .pullDownMenu:hover {
      background-color: #e0ecff;
    }

    select {
      background-color: #ffffff;
      border: 2px solid #aaaaaa;
      height: 24px;
      vertical-align: middle;
      font-size: 12px;
    }

    select:hover {
      background-color: #ffffff;
      border: 2px solid #aaccff;
    }

    span.math.inline a {
      color: #000000;
    }

    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #ffffff;
        color: #666666;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #666666;  padding-left: 4px; }
    div.sourceCode
      { color: #000000; background-color: #ffffff; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; text-decoration: underline; } /* Alert */
    code span.an { color: #666666; text-decoration: underline; } /* Annotation */
    code span.at { color: #333333; } /* Attribute */
    code span.bu { color: #000000; } /* BuiltIn */
    code span.cf { color: #666666; } /* ControlFlow */
    code span.ch { color: #b000b0; } /* Char */
    code span.cn { color: #000000; } /* Constant */
    code span.co { color: #008800; } /* Comment */
    code span.cv { color: #008800; } /* CommentVar */
    code span.do { color: #008800; } /* Documentation */
    code span.dt { color: #333333; } /* DataType */
    code span.dv { color: #0000ff; } /* DecVal */
    code span.er { color: #ffffff; background-color: #ff0000; } /* Error */
    code span.ex { color: #000000; } /* Extension */
    code span.fl { color: #0000ff; } /* Float */
    code span.im { color: #666666; } /* Import */
    code span.in { color: #666666; } /* Information */
    code span.kw { color: #666666; } /* Keyword */
    code span.op { color: #000000; } /* Operator */
    code span.ot { color: #000000; } /* Other */
    code span.pp { color: #666666; } /* Preprocessor */
    code span.sc { color: #b000b0; } /* SpecialChar */
    code span.ss { color: #b000b0; } /* SpecialString */
    code span.st { color: #b000b0; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #b000b0; } /* VerbatimString */
    code span.wa { color: #000000; background-color: #ffff00; text-decoration: underline; } /* Warning */
  </style>

    <script>
    MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script src="../lib/MathJax/es5/tex-chtml-full.js"
  type="text/javascript"></script>
    </head>

<body>
    <header>
    <p>
      何かあれば <a href="https://github.com/ryukau/filter_notes">GitHub のリポジトリ</a>に issue を作るか ryukau@gmail.com までお気軽にどうぞ。
    </p>
    <hr>
    <a href="../index.html">インデックスに戻る</a>
        <p>
      Update: 2025-01-07
    </p>
            <details>
      <summary translate="yes">Table of Contents</summary>
      <nav id="TOC" role="doc-toc">
        <ul>
        <li><a href="#ptr-台形オシレータ"
        id="toc-ptr-台形オシレータ">PTR 台形オシレータ</a>
        <ul>
        <li><a href="#ptr-台形の特性" id="toc-ptr-台形の特性">PTR
        台形の特性</a>
        <ul>
        <li><a href="#y-の値" id="toc-y-の値"><span
        class="math inline">\(y\)</span> の値</a></li>
        <li><a href="#a_1-と-a_2-の関係"
        id="toc-a_1-と-a_2-の関係"><span
        class="math inline">\(A_1\)</span> と <span
        class="math inline">\(A_2\)</span> の関係</a></li>
        <li><a href="#a_1-の範囲" id="toc-a_1-の範囲"><span
        class="math inline">\(A_1\)</span> の範囲</a></li>
        <li><a href="#k-の範囲" id="toc-k-の範囲"><span
        class="math inline">\(K\)</span> の範囲</a></li>
        <li><a href="#直流補正" id="toc-直流補正">直流補正</a></li>
        </ul></li>
        <li><a href="#音程が高いときのノイズの低減"
        id="toc-音程が高いときのノイズの低減">音程が高いときのノイズの低減</a></li>
        <li><a href="#実装" id="toc-実装">実装</a></li>
        </ul></li>
        </ul>
      </nav>
    </details>
      </header>
  <h1 id="ptr-台形オシレータ"><a href="#ptr-台形オシレータ"
  class="header-anchor" aria-hidden="true">PTR 台形オシレータ</a></h1>
  <p><a
  href="https://ryukau.github.io/VSTPlugins/manual/TrapezoidSynth/TrapezoidSynth_ja.html">TrapezoidSynth</a>
  の<a
  href="https://github.com/ryukau/VSTPlugins/blob/91d663e7ed916bc7c5e372990ad40eb9736ad84e/TrapezoidSynth/source/dsp/oscillator.hpp#L106">オシレータのコード</a>があまりにも場当たり的で自分でも読めなくなったので整理しました。</p>
  <h2 id="ptr-台形の特性"><a href="#ptr-台形の特性"
  class="header-anchor" aria-hidden="true">PTR 台形の特性</a></h2>
  <p>TrapezoidSynth の PTR 台形オシレータは 4 つの PTR <a
  href="https://en.wikipedia.org/wiki/Ramp_function">ランプ関数</a>をつぎはぎすることで台形を合成しています。このつぎはぎが複雑さの原因です。</p>
  <p>ランプ関数の定義です。</p>
  <p><span class="math display">\[
  R(x) = \begin{cases}
  0, &amp; \text{if}\ x &lt; 0,\\
  x, &amp; \text{otherwise.}
  \end{cases}
  \]</span></p>
  <p>PTR ランプ関数の導出は次のリンクにまとめています。</p>
  <ul>
  <li><a href="../ptr_oscillator/ptr_oscillator.html">PTR
  オシレータ</a></li>
  </ul>
  <p>次の図はランプ関数のつぎはぎの様子を表しています。下側の矢印はランプ関数の
  <span class="math inline">\(x\)</span> が増える方向です。</p>
  <figure>
  <img src="img/ramp_patch.svg" alt="Image of trapezoid made from 4 ramp functions." style="width: 480px;padding-bottom: 12px;"/>
  </figure>
  <ul>
  <li><a href="https://en.wikipedia.org/wiki/Ramp_function">Ramp
  function - Wikipedia</a></li>
  </ul>
  <p>まずは台形の各部に名前をつけます。</p>
  <figure>
  <img src="img/trapezoid_dc1.svg" alt="Image of trapezoid with name of parts." style="width: 480px;padding-bottom: 12px;"/>
  </figure>
  <h3 id="y-の値"><a href="#y-の値" class="header-anchor"
  aria-hidden="true"><span class="math inline">\(y\)</span>
  の値</a></h3>
  <p>PTR の次数を <span class="math inline">\(N\)</span> 、 1
  サンプルあたりに進む位相を <span class="math inline">\(T\)</span>
  とすると <span class="math inline">\(y = 1 - 2 K N T\)</span> です。
  <span class="math inline">\(- 2 K N T\)</span>
  という値は試行錯誤して見つけた適当な値です。</p>
  <h3 id="a_1-と-a_2-の関係"><a href="#a_1-と-a_2-の関係"
  class="header-anchor" aria-hidden="true"><span
  class="math inline">\(A_1\)</span> と <span
  class="math inline">\(A_2\)</span> の関係</a></h3>
  <p><span class="math inline">\(A_1\)</span> と <span
  class="math inline">\(K\)</span> はユーザが決定する定数です。 <span
  class="math inline">\(A_1\)</span> は1つ目の台形の上辺の長さ、 <span
  class="math inline">\(K\)</span> は台形の斜線の傾きです。</p>
  <p><span class="math inline">\(B_1 + B_2\)</span> は 1
  周期の波長です。ここでは正規化して <span class="math inline">\(B_1 +
  B_2 = 1\)</span>
  と定義します。この定義を使って、2つ目の台形の上辺の長さ <span
  class="math inline">\(A_2\)</span> を計算できます。</p>
  <p><span class="math display">\[
  \begin{aligned}
  A_2 &amp;= B_1 + B_2 - A_1 - \frac{1}{K}\\
    &amp;= 1 - A_1 - \frac{1}{K} &amp; \text{(1)}
  \end{aligned}
  \]</span></p>
  <h3 id="a_1-の範囲"><a href="#a_1-の範囲" class="header-anchor"
  aria-hidden="true"><span class="math inline">\(A_1\)</span>
  の範囲</a></h3>
  <p><span class="math inline">\(A_1\)</span> の最小値は <span
  class="math inline">\(0\)</span> です。</p>
  <p><span class="math inline">\(A_1\)</span> が最大となるとき、 <span
  class="math inline">\(A_2 = 0\)</span> です。 <span
  class="math inline">\(A_2 = 0\)</span> を式 (1) に代入すると <span
  class="math inline">\(A_1\)</span> の最大値 <span
  class="math inline">\(1 - \dfrac{1}{K}\)</span> が得られます。</p>
  <h3 id="k-の範囲"><a href="#k-の範囲" class="header-anchor"
  aria-hidden="true"><span class="math inline">\(K\)</span>
  の範囲</a></h3>
  <p><span class="math inline">\(A_1 = 0,\ A_2 = 0\)</span> のとき、式
  (1) より <span class="math inline">\(K = 1\)</span>
  です。このとき三角波に近い波形になります。 <span
  class="math inline">\(K &lt; 1\)</span>
  のときは三角波が途中でハードシンクされたような滑らかでない波形になります。</p>
  <p><span class="math inline">\(A_1 = 0,\ A_2 = 1\)</span> のとき、式
  (1) より <span class="math inline">\(K = \infty\)</span>
  となります。ただし、実際に <span class="math inline">\(K =
  \infty\)</span> とすると PTR
  の遷移領域を飛び越えてしまうので波形が不連続になってしまいます。そこで、実装では
  <span class="math inline">\(A_1 = 0,\ A_2 = 1 - 4 N T\)</span> を式
  (1) に代入して得られる <span class="math inline">\(K = \dfrac{1}{4 N
  T}\)</span> を <span class="math inline">\(K\)</span>
  の最大値としています。 <span class="math inline">\(4 N T\)</span> は 4
  つの PTR ランプ関数の遷移領域の長さです。</p>
  <h3 id="直流補正"><a href="#直流補正" class="header-anchor"
  aria-hidden="true">直流補正</a></h3>
  <p>図では <span class="math inline">\(h\)</span>
  を引いて直流成分を補正しています。 <span class="math inline">\(A_1,
  B_1\)</span> からなる台形 1 と、 <span class="math inline">\(A_2,
  B_2\)</span> からなる台形 2 の面積が等しいときに直流が 0 になります。
  <span class="math inline">\(h\)</span> を求める方程式を立てます。</p>
  <p><span class="math display">\[
  \begin{aligned}
  B_1 &amp;= A_1 + \frac{2(y - h)}{K}\\
  B_2 &amp;= A_2 + \frac{2h}{K}\\
  \frac{(A_1 + B_1) (y - h)}{2} &amp;= \frac{(A_2 + B_2) h}{2}\\
  \end{aligned}
  \]</span></p>
  <p>Maxima で解きます。</p>
  <div class="sourceCode" id="cb1"><pre
  class="sourceCode maxima"><code class="sourceCode maxima"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cn">A2</span>: <span class="dv">1</span> - <span class="cn">A1</span> - <span class="dv">1</span> / <span class="cn">K</span>;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cn">B1</span>: <span class="cn">A1</span> + <span class="dv">2</span> * (<span class="cn">y</span> - <span class="cn">h</span>) / <span class="cn">K</span>;</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cn">B2</span>: <span class="cn">A2</span> + <span class="dv">2</span> * <span class="cn">h</span> / <span class="cn">K</span>;</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cn">eq</span>: (<span class="cn">A1</span> + <span class="cn">B1</span>) * (<span class="cn">y</span> - <span class="cn">h</span>) / <span class="dv">2</span> = (<span class="cn">A2</span> + <span class="cn">B2</span>) * <span class="cn">h</span> / <span class="dv">2</span>;</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">expand</span>(<span class="fu">solve</span>(<span class="cn">eq</span>, <span class="cn">h</span>));</span></code></pre></div>
  <p>出力です。</p>
  <p><span class="math display">\[
  h=\frac{y^2 + A_1 K y}{2 y+K-1}
  \]</span></p>
  <p>これで直流成分の大きさ <span class="math inline">\(h\)</span>
  が分かりました。</p>
  <h2 id="音程が高いときのノイズの低減"><a
  href="#音程が高いときのノイズの低減" class="header-anchor"
  aria-hidden="true">音程が高いときのノイズの低減</a></h2>
  <p>記号の定義です。</p>
  <ul>
  <li><span class="math inline">\(f\)</span> : オシレータの周波数</li>
  <li><span class="math inline">\(f_s\)</span> : サンプリング周波数</li>
  <li><span class="math inline">\(N\)</span> : PTR の次数</li>
  </ul>
  <p>PTR 台形オシレータの次数 <span class="math inline">\(N\)</span>
  を大きくするほどエイリアシングノイズが低減されますが、周波数が <span
  class="math inline">\(\dfrac{f_s}{4 N}\)</span>
  を超えるとノイズが増えてしまうというトレードオフがあります。ノイズが乗るのは
  4 つのランプ関数のすべての遷移領域を通過する前に波形の 1
  周期が終わってしまうからです。</p>
  <p><span class="math inline">\(f_s = 44100\)</span> として <span
  class="math inline">\(N\)</span>
  を変えたときのノイズが乗らない周波数の上限は次のようになります。</p>
  <ul>
  <li><span class="math inline">\(N = 2 \to
  5512.5\,\mathrm{Hz}\)</span></li>
  <li><span class="math inline">\(N = 3 \to
  3675\,\mathrm{Hz}\)</span></li>
  <li><span class="math inline">\(N = 4 \to
  2756.25\,\mathrm{Hz}\)</span></li>
  <li><span class="math inline">\(N = 5 \to
  2205\,\mathrm{Hz}\)</span></li>
  </ul>
  <p><span class="math inline">\(f_s \geq 44100\)</span> のときは <span
  class="math inline">\(N = 4\)</span> にして 8
  倍のオーバーサンプリングをかけると、ノイズが乗らない周波数の上限が
  22050 Hz
  になるので十分な音域が使えるようになります。ただし、オーバーサンプリングを使わずにエイリアシングノイズを効率よく低減できるという
  PTR の利点を無視することになります。</p>
  <p>オーバーサンプリングを極力避けるためには次の式のように PTR
  の次数を切り替えることが考えられます。例として <span
  class="math inline">\(N\)</span> が 2 から 5
  の間で切り替わっています。</p>
  <p><span class="math display">\[
  \begin{aligned}
  N_{\mathtt{TrapezoidSynth}}(f) &amp;= \begin{cases}
  5, &amp; \text{if} \enspace f &lt; f_u(5)\\
  4, &amp; \text{if} \enspace f_u(5) \leq f &lt; f_u(4)\\
  3, &amp; \text{if} \enspace f_u(4) \leq f &lt; f_u(3)\\
  2, &amp; \text{if} \enspace f_u(3) \leq f\\
  \end{cases}\\
  \text{where}\enspace
  f_u(N) &amp;= \frac{f_s}{4 N}
  \end{aligned}
  \]</span></p>
  <p>分岐処理がオーバーサンプリングよりも速いかどうかはベンチマークを取ってみないとわかりません。また
  <span class="math inline">\(N\)</span>
  の切り替えのタイミングで不連続になるので、ピッチベンドなどで周波数が動くとノイズが乗ります。</p>
  <p>TrapezoidSynth では何を思ったのか <span
  class="math inline">\(N\)</span> の切り替えと 8
  倍のオーバーサンプリングの両方が実装されています。</p>
  <h2 id="実装"><a href="#実装" class="header-anchor"
  aria-hidden="true">実装</a></h2>
  <p>C++ です。</p>
  <p>定数をキャストしているのはテンプレートで <code>float</code> と
  <code>double</code>
  を切り替えることを想定していたからです。結局オーバーサンプリングしてごまかしたのでテンプレート化は見送りました。</p>
  <div class="sourceCode" id="cb2"><pre
  class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PTRTrapezoidOsc <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  PTRTrapezoidOsc<span class="op">(</span><span class="dt">float</span> sampleRate<span class="op">,</span> <span class="dt">float</span> frequencyHz<span class="op">)</span> <span class="op">:</span> sampleRate<span class="op">(</span>sampleRate<span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    setFreq<span class="op">(</span>frequencyHz<span class="op">);</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> setFreq<span class="op">(</span><span class="dt">float</span> hz<span class="op">)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>hz <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">)</span> tick <span class="op">=</span> hz <span class="op">/</span> sampleRate<span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> setPhase<span class="op">(</span><span class="dt">float</span> phase<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">-&gt;</span>phase <span class="op">=</span> phase<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> addPhase<span class="op">(</span><span class="dt">float</span> phase<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">-&gt;</span>phase <span class="op">+=</span> phase<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> setSlope<span class="op">(</span><span class="dt">float</span> slope<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">-&gt;</span>slope <span class="op">=</span> slope<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> setPulseWidth<span class="op">(</span><span class="dt">float</span> pw<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">-&gt;</span>pw <span class="op">=</span> pw<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> reset<span class="op">()</span> <span class="op">{</span> phase <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> process<span class="op">()</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>tick <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    phase <span class="op">+=</span> tick<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    phase <span class="op">-=</span> somefloor<span class="op">&lt;</span><span class="dt">float</span><span class="op">&gt;(</span>phase<span class="op">);</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ptrTpz5<span class="op">(</span>phase<span class="op">,</span> tick<span class="op">,</span> slope<span class="op">,</span> pw<span class="op">);</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> sampleRate<span class="op">;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> phase <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> tick <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> slope <span class="op">=</span> <span class="dv">8</span><span class="op">;</span>       <span class="co">// 台形の斜辺の傾き。この文章の K に相当。</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> pw <span class="op">=</span> <span class="dt">float</span><span class="op">(</span><span class="fl">0.5</span><span class="op">);</span> <span class="co">// Pulse width. A1 に相当。</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span><span class="op">:</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// tick must be greater than 0.</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">static</span> <span class="dt">float</span> ptrTpz5<span class="op">(</span><span class="dt">float</span> phase<span class="op">,</span> <span class="dt">float</span> tick<span class="op">,</span> <span class="dt">float</span> slope<span class="op">,</span> <span class="dt">float</span> pw<span class="op">)</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> order <span class="op">=</span> <span class="dv">5</span><span class="op">;</span> <span class="co">// PTR の次数。 N に相当。</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>order <span class="op">&gt;</span> <span class="dt">float</span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">/</span> tick<span class="op">)</span> order <span class="op">=</span> <span class="dt">int</span><span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">/</span> tick<span class="op">);</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">float</span> ptrLen <span class="op">=</span> order <span class="op">*</span> tick<span class="op">;</span> <span class="co">// NT に相当。</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// A1 の範囲を制限。</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">float</span> maxSlope <span class="op">=</span> <span class="dt">float</span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">/</span> ptrLen<span class="op">;</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>slope <span class="op">&gt;</span> maxSlope<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>      slope <span class="op">=</span> maxSlope<span class="op">;</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">const</span> <span class="dt">float</span> minSlope <span class="op">=</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>slope <span class="op">&lt;</span> minSlope<span class="op">)</span> slope <span class="op">=</span> minSlope<span class="op">;</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// K の範囲を制限。</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">float</span> maxPw <span class="op">=</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">/</span> slope<span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pw <span class="op">&gt;</span> maxPw<span class="op">)</span> pw <span class="op">=</span> <span class="bu">std::</span>max<span class="op">&lt;</span><span class="dt">float</span><span class="op">&gt;(</span><span class="dt">float</span><span class="op">(</span><span class="dv">0</span><span class="op">),</span> maxPw<span class="op">);</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 直流の計算。 y は適当に見つけた上手く動く値。</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">float</span> y <span class="op">=</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> slope <span class="op">*</span> ptrLen<span class="op">;</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">float</span> dc <span class="op">=</span> <span class="op">(</span>y <span class="op">*</span> y <span class="op">+</span> pw <span class="op">*</span> slope <span class="op">*</span> y<span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> y <span class="op">+</span> slope <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// N による分岐。</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>order <span class="op">==</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> branch<span class="op">&lt;</span>PTRTrapezoidOsc<span class="op">::</span>ptrRamp5<span class="op">&gt;(</span>slope<span class="op">,</span> pw<span class="op">,</span> y<span class="op">,</span> phase<span class="op">,</span> tick<span class="op">)</span> <span class="op">-</span> dc<span class="op">;</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>order <span class="op">==</span> <span class="dv">4</span><span class="op">)</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> branch<span class="op">&lt;</span>PTRTrapezoidOsc<span class="op">::</span>ptrRamp4<span class="op">&gt;(</span>slope<span class="op">,</span> pw<span class="op">,</span> y<span class="op">,</span> phase<span class="op">,</span> tick<span class="op">)</span> <span class="op">-</span> dc<span class="op">;</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>order <span class="op">==</span> <span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> branch<span class="op">&lt;</span>PTRTrapezoidOsc<span class="op">::</span>ptrRamp3<span class="op">&gt;(</span>slope<span class="op">,</span> pw<span class="op">,</span> y<span class="op">,</span> phase<span class="op">,</span> tick<span class="op">)</span> <span class="op">-</span> dc<span class="op">;</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> branch<span class="op">&lt;</span>PTRTrapezoidOsc<span class="op">::</span>ptrRamp2<span class="op">&gt;(</span>slope<span class="op">,</span> pw<span class="op">,</span> y<span class="op">,</span> phase<span class="op">,</span> tick<span class="op">)</span> <span class="op">-</span> dc<span class="op">;</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  <span class="kw">template</span><span class="op">&lt;</span><span class="dt">float</span> <span class="op">(*</span>ptrfunc<span class="op">)(</span><span class="dt">float</span><span class="op">,</span> <span class="dt">float</span><span class="op">)&gt;</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">static</span> <span class="dt">float</span> branch<span class="op">(</span><span class="dt">float</span> slope<span class="op">,</span> <span class="dt">float</span> pw<span class="op">,</span> <span class="dt">float</span> y<span class="op">,</span> <span class="dt">float</span> phase<span class="op">,</span> <span class="dt">float</span> tick<span class="op">)</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ランプ関数のつぎはぎを行う分岐。</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>phase <span class="op">&lt;=</span> <span class="dt">float</span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span> <span class="op">/</span> slope<span class="op">)</span> <span class="co">// Ramp 1</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> slope <span class="op">*</span> ptrfunc<span class="op">(</span>phase<span class="op">,</span> tick<span class="op">);</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>phase <span class="op">&lt;=</span> <span class="dt">float</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> slope<span class="op">)</span> <span class="co">// Ramp 2</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> y <span class="op">-</span> slope <span class="op">*</span> ptrfunc<span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> slope <span class="op">-</span> phase<span class="op">,</span> tick<span class="op">);</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>phase <span class="op">&lt;=</span> <span class="dt">float</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> slope <span class="op">+</span> pw<span class="op">)</span> <span class="co">// 台形の上辺。</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> y<span class="op">;</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>phase <span class="op">&lt;=</span> <span class="dt">float</span><span class="op">(</span><span class="fl">0.75</span><span class="op">)</span> <span class="op">/</span> slope <span class="op">+</span> pw<span class="op">)</span> <span class="co">// Ramp 3</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> y <span class="op">-</span> slope <span class="op">*</span> ptrfunc<span class="op">(</span>phase <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> slope <span class="op">-</span> pw<span class="op">,</span> tick<span class="op">);</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>phase <span class="op">&lt;=</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">/</span> slope <span class="op">+</span> pw<span class="op">)</span> <span class="co">// Ramp 4</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> slope <span class="op">*</span> ptrfunc<span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">/</span> slope <span class="op">+</span> pw <span class="op">+</span> <span class="op">-</span>phase<span class="op">,</span> tick<span class="op">);</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dt">float</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// 残りを 0 埋め。台形の各部の名前の図の A2 にあたる領域。</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 以降は PTR ランプ関数。</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">static</span> <span class="dt">float</span> ptrRamp2<span class="op">(</span><span class="dt">float</span> phi<span class="op">,</span> <span class="dt">float</span> T<span class="op">)</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> n <span class="op">=</span> phi <span class="op">/</span> T<span class="op">;</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&gt;=</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">))</span> <span class="cf">return</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T<span class="op">;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">))</span> <span class="cf">return</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">))</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">-(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">+</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span> <span class="co">// Just in case.</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">static</span> <span class="dt">float</span> ptrRamp3<span class="op">(</span><span class="dt">float</span> phi<span class="op">,</span> <span class="dt">float</span> T<span class="op">)</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> n <span class="op">=</span> phi <span class="op">/</span> T<span class="op">;</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&gt;=</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">))</span> <span class="cf">return</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">*</span> T<span class="op">;</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">))</span> <span class="cf">return</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">12</span><span class="op">);</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">))</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">-(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">6</span><span class="op">)</span> <span class="op">+</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">+</span> T <span class="op">*</span> n <span class="op">-</span> T <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">))</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">12</span><span class="op">)</span> <span class="op">-</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">9</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">7</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">15</span><span class="op">)</span> <span class="op">*</span> T<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span> <span class="co">// Just in case.</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">static</span> <span class="dt">float</span> ptrRamp4<span class="op">(</span><span class="dt">float</span> phi<span class="op">,</span> <span class="dt">float</span> T<span class="op">)</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> n <span class="op">=</span> phi <span class="op">/</span> T<span class="op">;</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&gt;=</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">))</span> <span class="cf">return</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">)</span> <span class="op">*</span> T<span class="op">;</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">))</span> <span class="cf">return</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">60</span><span class="op">);</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">))</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">-(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">20</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span>T <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">+</span> T <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">15</span><span class="op">);</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">))</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">20</span><span class="op">)</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">22</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">23</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">47</span><span class="op">)</span> <span class="op">*</span> T<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">15</span><span class="op">);</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">))</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">-(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">60</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">8</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">32</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">58</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">196</span><span class="op">)</span> <span class="op">*</span> T<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">15</span><span class="op">);</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span> <span class="co">// Just in case.</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>  <span class="at">static</span> <span class="dt">float</span> ptrRamp5<span class="op">(</span><span class="dt">float</span> phi<span class="op">,</span> <span class="dt">float</span> T<span class="op">)</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> n <span class="op">=</span> phi <span class="op">/</span> T<span class="op">;</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&gt;=</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">))</span> <span class="cf">return</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">-</span> <span class="dt">float</span><span class="op">(</span><span class="dv">5</span><span class="op">)</span> <span class="op">*</span> T<span class="op">;</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">1</span><span class="op">))</span> <span class="cf">return</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">360</span><span class="op">);</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">2</span><span class="op">))</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">-(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">90</span><span class="op">)</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">12</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">5</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">5</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">18</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">5</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span>T <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">12</span><span class="op">)</span> <span class="op">-</span> T <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">72</span><span class="op">);</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">3</span><span class="op">))</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">60</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">)</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">35</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">25</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">6</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">155</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">21</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">127</span><span class="op">)</span> <span class="op">*</span> T<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">72</span><span class="op">);</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">))</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">-(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">90</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">)</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">55</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">65</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">6</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">655</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">141</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">4</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">1331</span><span class="op">)</span> <span class="op">*</span> T<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">72</span><span class="op">);</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dt">float</span><span class="op">(</span><span class="dv">5</span><span class="op">))</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">360</span><span class="op">)</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span>T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">12</span><span class="op">)</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">25</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">125</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">18</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">625</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">24</span><span class="op">)</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">601</span><span class="op">)</span> <span class="op">*</span> T <span class="op">*</span> n<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">12</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="dt">float</span><span class="op">(</span><span class="dv">2765</span><span class="op">)</span> <span class="op">*</span> T<span class="op">)</span> <span class="op">/</span> <span class="dt">float</span><span class="op">(</span><span class="dv">72</span><span class="op">);</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span> <span class="co">// Just in case.</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
    <footer>
    <a href="../index.html">インデックスに戻る</a>
  </footer>
</body>

</html>
